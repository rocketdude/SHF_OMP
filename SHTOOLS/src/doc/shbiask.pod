=head1 SHBiasK

=over 10

=item SHBiasK -  

Calculate the multitaper (cross-)power spectrum expectation of a windowed function.

=back

=head1 SYNOPSIS

=over 21

=item SUBROUTINE SHBiasK ( 

TAPERS, LWIN, NUMK, INCSPECTRA, LDATA, S<OUTCSPECTRA>, TAPER_WT, SAVE_CG )

=back

=over 4

=over 21

=item REAL*8	

TAPERS(LWIN+1, NUMK), INCSPECTRA(LDATA+1), OUTCSPECTRA(*)

=item INTEGER

LWIN, NUMK, LDATA

=item REAL*8, OPTIONAL

TAPER_WT(NUMK)

=item INTEGER, OPTIONAL

SAVE_CG

=back

=back

=head1 DESCRIPTION

I<SHBiasK> will calculate the multitaper (cross-)power spectrum expectation of a function multiplied by the NUMK best-concentrated localizing windows. This is given by equation 36 of Wieczorek and Simons (2005) (see also eq. 2.11 of Wieczorek and Simons 2007). In contrast to I<SHBias>, which takes as input the power spectrum of a single localizing window, this routine expects as input a matrix containing the spherical harmonic coefficients of the localizing windows. These can be generated by a call to I<SHReturnTapers> or I<SHReturnTapersM>. The maximum calculated degree of the windowed power spectrum expectation corresponds to the smaller of (LDATA+LWIN) and SIZE(OUTCSPECTRA)-1. It is implicitly assumed that the power spectrum of the INSPECTRUM is zero beyond degree LDATA. Note that this routine will only work when the window coefficients are non-zero for a single angular order.

The default is to apply equal weights to each individual windowed estimate of the spectrum, but this can be modified by specifying the weights in the optional argument TAPER_WT. The weights must sum to unity. 

If this routine is to be called several times using the same values of LWIN and LDATA, then the Clebsch-Gordon coefficients can be precomputed and saved by setting the optional parameter SAVE_CG equal to 1.


=head1 ARGUMENTS

=over 14

=item TAPERS

(input) REAL*8, DIMENSION (LWIN+1, NUMK)

The spherical coefficients of the localizing windows. Each column corresponds to the non-zero coefficients of a single angular order. Since all that is important is the power spectrum of each window, the exact angular order is not important. These are generated by a call to I<SHReturnTapers> or I<SHReturnTapersM>.

=item LWIN

(input) INTEGER

The spherical harmonic bandwidth of the localizing windows.

=item NUMK

(input) INTEGER

The number of localizing windows to use. Only the first NUMK columns of TAPERS will be employed, which corresponds to the best-concentrated localizing windows.
	
=item INCSPECTRA

(input) REAL*8, DIMENSION (LDATA+1)

The global unwindowed power spectrum.

=item LDATA

(input) INTEGER

The maximum degree of the global unwindowed power spectrum.

=item OUTCSPECTRA

(output) REAL*8, DIMENSION (*)

The expectation of the multitaper localized power spectrum. The maximum spherical harmonic degree of the output is min(LDATA+LWIN, SIZE(OUTSCSPECTRA)-1).

=item TAPER_WT

(input) REAL*8, OPTIONAL, DIMENSION (NUMK)

The weights to apply to each individual windowed specral estimate. The weights must sum to unity. The weights must sum to unity and are obtained from I<SHMTVarOpt> or I<SHMTVarOpt0>.

=item SAVE_CG

(input) INTEGER, OPTIONAL

If set equal to 1, the Clebsch-Gordon coefficients will be precomputed and saved for future use (if LWIN or LDATA change, this will be recomputed). To deallocate the saved memory, set this parameter equal to 1. If set equal to 0 (default), the Clebsch-Gordon coefficients will be recomputed for each call.

=back

=head1 SEE ALSO

shbias(1), shmtvaropt0(1), shmtvaropt(1), shreturntapers(1), shreturntapersm(1), shmtvaropt(1), shmtvaropt0(1), shbiasadmitcorr(1)

L<http://shtools.ipgp.fr/>

=head1 REFERENCES

Wieczorek, M. A. and F. J. Minimum-variance multitaper spectral estimation on the sphere, I<J. Fourier Anal. Appl.>, 13, 665-692, doi:10.1007/s00041-006-6904-1, 2007.

Simons, F. J., F. A. Dahlen and M. A. Wieczorek, Spatiospectral concentration on a sphere, I<SIAM Review>, 48, 504-536, doi:10.1137/S0036144504445765, 2006. 

Wieczorek, M. A. and F. J. Simons, Localized spectral analysis on the sphere, 
I<Geophys. J. Int.>, 162, 655-675, doi:10.1111/j.1365-246X.2005.02687.x, 2005.

=head1 COPYRIGHT AND LICENSE

Copyright 2012 by Mark Wieczorek <wieczor@ipgp.fr>.

This is free software; you can distribute and modify it under the terms of the revised BSD license.